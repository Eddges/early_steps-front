<!DOCTYPE html>
<html class="no-js css-menubar" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="bootstrap admin template">
    <meta name="author" content="">
    
    <title>CodeAsylums</title>
<!--     
    <link rel="apple-touch-icon" href="../../assets/images/apple-touch-icon.png">
    <link rel="shortcut icon" href="../../assets/images/favicon.ico"> -->
    
    <link rel="apple-touch-icon" href="../../assets/images/logo-ca.png">
    <link rel="shortcut icon" href="../../assets/images/logo-ca.png">
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../../../global/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../global/css/bootstrap-extend.min.css">
    <link rel="stylesheet" href="../../assets/css/site.min.css">
    
    <!-- Plugins -->
    <link rel="stylesheet" href="../../../global/vendor/animsition/animsition.css">
    <link rel="stylesheet" href="../../../global/vendor/asscrollable/asScrollable.css">
    <link rel="stylesheet" href="../../../global/vendor/switchery/switchery.css">
    <link rel="stylesheet" href="../../../global/vendor/intro-js/introjs.css">
    <link rel="stylesheet" href="../../../global/vendor/slidepanel/slidePanel.css">
    <link rel="stylesheet" href="../../../global/vendor/flag-icon-css/flag-icon.css">
    <link rel="stylesheet" href="../../assets/examples/css/pages/register-v3.css">
    
    
    <!-- Fonts -->
    <link rel="stylesheet" href="../../../global/fonts/web-icons/web-icons.min.css">
    <link rel="stylesheet" href="../../../global/fonts/brand-icons/brand-icons.min.css">
    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,300italic'>
    
    <!--[if lt IE 9]>
    <script src="../../../global/vendor/html5shiv/html5shiv.min.js"></script>
    <![endif]-->
    
    <!--[if lt IE 10]>
    <script src="../../../global/vendor/media-match/media.match.min.js"></script>
    <script src="../../../global/vendor/respond/respond.min.js"></script>
    <![endif]-->
    
    <!-- Scripts -->
    <script src="../../../global/vendor/breakpoints/breakpoints.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.5.0/js/md5.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      Breakpoints();
    </script>
  </head>
  <body class="animsition page-register-v3 layout-full">
    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->


    <!-- Page -->
    <div class="page vertical-align text-center" data-animsition-in="fade-in" data-animsition-out="fade-out">>
      <div class="page-content vertical-align-middle animation-slide-top animation-duration-1">
        <div class="panel">
         <!-- alert message -->
         <div class="alert dark alert-danger alert-dismissible animation-slide-top " id="alert-message-div" style="display:none" role="alert">
                    <button type="button" class="close" onClick="hideme()" aria-label="Close">
                      <span aria-hidden="true">×</span>
                    </button>
                    <div id="message-div"></div>
                  </div>
          <!-- End alert message -->
          <div class="panel-body">
            <div class="brand">
              <img class="brand-img" src="../../assets//images/logo-ca.png" alt="..." style="width:40%">
              
            </div>
            <form>
              <div class="form-group form-material floating" data-plugin="formMaterial">
                <input onclick="clearAlert()" id="username" type="text" class="form-control" name="username" required="required"/>
                <label class="floating-label">UserName</label>
              </div>
              <div class="form-group form-material floating" data-plugin="formMaterial">
                <input onclick="clearAlert()" id="email" type="email" class="form-control" name="email" required="required"/>
                <label class="floating-label">Email</label>
              </div>
              <div class="form-group form-material floating" data-plugin="formMaterial">
                <input onclick="clearAlert()" id="phone" type="phone" class="form-control" name="phone" required="required"/>
                <label class="floating-label">Phone No</label>
              </div>
              <div class="form-group form-material floating" data-plugin="formMaterial">
                <input onclick="clearAlert()" id="password" type="password" class="form-control" name="password" required="required"/>
                <label class="floating-label">Password</label>
              </div>
              <div class="form-group form-material floating" data-plugin="formMaterial">
                <input onclick="clearAlert()" id="retypePassword" type="password" class="form-control" name="PasswordCheck" required="required"/>
                <label class="floating-label">Re-enter Password</label>
              </div>
              <a class="btn btn-primary btn-block btn-lg mx-auto" onclick="doregistration();" style="color:white;">Sign up</a>
            </form>
            <p>Have account already? Please go to <a href="login">Sign In</a></p>
          </div>
        </div>

        <footer class="page-copyright page-copyright-inverse">
           <p>CODEASYLUMS</p>
          <p>© 2020. All RIGHT RESERVED.</p>
         
        </footer>
      </div>
    </div>
    <!-- End Page -->


    <!-- Core  -->
    <script src="../../../global/vendor/babel-external-helpers/babel-external-helpers.js"></script>
    <script src="../../../global/vendor/jquery/jquery.js"></script>
    <script src="../../../global/vendor/popper-js/umd/popper.min.js"></script>
    <script src="../../../global/vendor/bootstrap/bootstrap.js"></script>
    <script src="../../../global/vendor/animsition/animsition.js"></script>
    <script src="../../../global/vendor/mousewheel/jquery.mousewheel.js"></script>
    <script src="../../../global/vendor/asscrollbar/jquery-asScrollbar.js"></script>
    <script src="../../../global/vendor/asscrollable/jquery-asScrollable.js"></script>
    <script src="../../../global/vendor/ashoverscroll/jquery-asHoverScroll.js"></script>
    
    <!-- Plugins -->
    <script src="../../../global/vendor/switchery/switchery.js"></script>
    <script src="../../../global/vendor/intro-js/intro.js"></script>
    <script src="../../../global/vendor/screenfull/screenfull.js"></script>
    <script src="../../../global/vendor/slidepanel/jquery-slidePanel.js"></script>
        <script src="../../../global/vendor/jquery-placeholder/jquery.placeholder.js"></script>
    
    <!-- Scripts -->
    <script src="../../../global/js/Component.js"></script>
    <script src="../../../global/js/Plugin.js"></script>
    <script src="../../../global/js/Base.js"></script>
    <script src="../../../global/js/Config.js"></script>
    
    <script src="../../assets/js/Section/Menubar.js"></script>
    <script src="../../assets/js/Section/GridMenu.js"></script>
    <script src="../../assets/js/Section/Sidebar.js"></script>
    <script src="../../assets/js/Section/PageAside.js"></script>
    <script src="../../assets/js/Plugin/menu.js"></script>
    
    <script src="../../../global/js/config/colors.js"></script>
    <script src="../../assets/js/config/tour.js"></script>
    <script>Config.set('assets', '../../assets');</script>
    
    <!-- Page -->
    <script src="../../assets/js/Site.js"></script>
    <script src="../../../global/js/Plugin/asscrollable.js"></script>
    <script src="../../../global/js/Plugin/slidepanel.js"></script>
    <script src="../../../global/js/Plugin/switchery.js"></script>
    <script src="../../../global/js/Plugin/jquery-placeholder.js"></script>
    <script src="../../../global/js/Plugin/material.js"></script>
    
    <script>
    
     function hideme(){
      document.getElementById('alert-message-div').style.display="none";
    }

      (function(document, window, $){
        'use strict';
    
        var Site = window.Site;
        $(document).ready(function(){
          Site.run();
        });
      })(document, window, jQuery);

      async function doregistration(){
        let usernameValue = document.getElementById("username").value;
        let emailValue = document.getElementById("email").value;
        let phoneValue = document.getElementById("phone").value;
        let passwordValue = md5(document.getElementById("password").value);
        let retypepasswordValue = md5(document.getElementById("retypePassword").value);

        if(usernameValue==""){
          document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Username is required";
          return false;
        }
         if(emailValue==""){
           document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Email is required";
          return false;
        }
          
          //var mailformat = /^w+([.-]?w+)*@w+([.-]?w+)*(.w{2,3})+$/;
          var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        
          if(!regex.test(emailValue))
          {
          document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="You have entered an invalid email address!";
          return false;
          }
        
          

         if(phoneValue==""){
           document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Phone is required";
          return false;
        }

        var phoneno = /^\d{10}$/;
        if(!(phoneValue.match(phoneno)))
        {
            document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Please enter 10 digit phone number";
          return false;
        }
      
         if(document.getElementById("password").value==""){
           document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Password is required";
          return false;
        }
         if(document.getElementById("retypePassword").value==""){
           document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Confirm password is required";
          return false;
        }
         if(document.getElementById("retypePassword").value!=document.getElementById("password").value){
           document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Passwords do not match";
          return false;
        }


        let userTypeValue = "student";
        let redirectURL = "./login";
        var flag1 = true;
        var flag2 = true
        console.log(flag1,flag2)
      await axios.get(`http://3.136.20.160:80/isRegisteredUserEmail/`+`${emailValue}`)
        .then((res)=>{
          if(res.data==="True")
            {
               document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Email already registered!";
          //return false;
           
          }
        })
        .catch(async (err)=>{
          flag1 = false;
          console.log(flag1,flag2)
          await axios.get(`http://3.136.20.160:80/isRegisteredUserPhone/`+`${phoneValue}`)
              .then((res)=>{
                if(res.data==="True")
                {
                    document.getElementById('alert-message-div').style.display="block";
          document.getElementById('message-div').innerHTML="Phone number already registered!";
          //return false;
                            
                }
              })
              .catch((err)=>{flag2 = false;console.log(flag1,flag2)})  
        })

        if (flag1 === false && flag2 === false){
           if (passwordValue === retypepasswordValue) {
              console.log("reg")
              axios.post('http://3.136.20.160:80/doRegistration', {
                user_id: phoneValue,
                user_type: userTypeValue,
                user_name: usernameValue,
                phone: phoneValue,
                email: emailValue,
                password: passwordValue
                })
                .then(function (response) {
                  console.log(response);
                  alert("Successfully Registered, Now Login!");
                  window.location.href = redirectURL;
                })
                .catch(function (error) {
                  console.log(error);
                  document.getElementById('alert-message-div').style.display="block";
                  document.getElementById('message-div').innerHTML="User Name already registered!";
                });
            }
        }
      }
      function clearAlert(){
          document.getElementById('alert-message-div').style.display="none";
        }    
    </script>
  </body>
</html>
