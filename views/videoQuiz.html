<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video View</title>
    <link rel="stylesheet" href="./styles/main.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>

    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
        <img src="assets/Logo.jpeg" height="50" alt="" loading="lazy">
        </a>
    </nav>

    <div class="container pt-5">    
        <div class="row">
            <div class="col-md divVideo">
                <video></video>
            </div>
        
            <div class="col-md pt-5 mt-5">
                <div class="w-100">
                    <button class="btn btn-primary w-50" id="btnStart">Start Recording</button>
                </div>
                <div class="w-100 mt-3">
                    <button class="btn btn-danger w-50" id="btnStop">Stop Recording</button>
                </div>
                <div class="w-100 mt-3">
                    <!-- <button class="btn btn-warning w-50" id="btnStop">Preview</button> -->
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-warning w-50" data-toggle="modal" data-target="#exampleModal">
                        Preview Video
                    </button>
                    
                    <!-- Modal -->
                    <div class="modal fade " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                        <div class="modal-content w-100">
                            <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Your video</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div>
                            <div class="modal-body d-flex justify-content-center">
                                <video id="vid2" controls style="width : 400px"></video>
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>
                            <button type="button" class="btn btn-success">Submit</button>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
                <div class="w-100 mt-4">
                    <button class="btn btn-success w-50" id="btnStop">Submit</button>
                </div>
                
                
            </div>
        </div>

        
        <!-- <video id="vid2" controls></video> -->
    </div>
    
    


</body>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<!-- <script src="./scripts/main.js"></script> -->
<script>

let constraintObj = {
    audio : true,
    video : {
        facingMode : 'user'
    }
}


navigator.mediaDevices.getUserMedia(constraintObj)
.then(mediaStreamObj => {
    let video = document.querySelector('video')
    video.srcObject = mediaStreamObj

    video.onloadedmetadata = (ev) => {
        video.play()
    }

    const start = document.getElementById('btnStart')
    const stop  = document.getElementById('btnStop')
    const vidSave = document.getElementById('vid2')
    const mediaRecorder = new MediaRecorder(mediaStreamObj)
    let chunks = []

    start.addEventListener('click', e => {
        mediaRecorder.start()
        console.log('Recording started')
    })

    stop.addEventListener('click', e => {
        mediaRecorder.stop()
        console.log('Recording stopped')
    })

    mediaRecorder.ondataavailable = e => {
        console.log('Pushing data into chunk')
        chunks.push(e.data)
    }

    mediaRecorder.onstop = e => {

        console.log('MediaRecorder stopped')
        let blob = new Blob(chunks, { 'type' : 'video/mp4' })
        chunks = []

        let videoURL = window.URL.createObjectURL(blob)
        console.log('VideoURL : ', videoURL)
        vidSave.src = videoURL
    }

})


</script>

</html>